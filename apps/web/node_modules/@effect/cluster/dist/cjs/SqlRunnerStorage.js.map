{"version":3,"file":"SqlRunnerStorage.js","names":["SqlClient","_interopRequireWildcard","require","Arr","Duration","Effect","Layer","Scope","_ClusterError","_resourceRef","RunnerStorage","ShardId","ShardingConfig","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","withTracerDisabled","withTracerEnabled","make","exports","fnUntraced","options","config","sql","withoutTransforms","prefix","table","name","acquireLockConn","onDialectOrElse","pg","scope","conn","orDie","reserve","pipe","extend","addFinalizerExit","executeRaw","mysql","orElse","undefined","lockConn","ResourceRef","from","runnersTable","runnersTableSql","hasOldTables","isSuccess","ignore","mssql","locksTable","locksTableSql","void","sqlNowString","sqlNow","literal","expiresSeconds","Math","ceil","toSeconds","shardLockExpiration","toString","lockExpiresAt","encodeBoolean","b","sqlite","insertRunner","address","runner","healthy","values","unprepared","map","results","machine_id","execWithLockConn","effect","query","params","compile","await","flatMap","onError","unsafeRebuild","execWithLockConnValues","executeValues","acquireLock","_address","shardIds","acquiredShardIds","toAcquire","Map","shardId","lockNumbers","takenLocks","length","lockNum","push","lockNumbersReverse","delete","size","rows","executeUnprepared","pgLocks","allMySqlTakenLocks","includes","mysqlLocks","stringLiteral","csv","andThen","acquiredLocks","withTransaction","shardGroups","group","base","shard","shardsPerGroup","lockNames","lockNamesReverse","lockName","shardIdsMap","Array","entries","join","stringLiteralArr","row","wrapString","s","arr","refreshShards","makeEncoded","getRunners","PersistenceError","refail","String","Boolean","register","Number","unregister","asVoid","setRunnerHealth","acquire","refresh","as","release","releaseAll","layer","scoped","layerWith"],"sources":["../../src/SqlRunnerStorage.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}